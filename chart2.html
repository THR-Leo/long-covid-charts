<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chart 2</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    :root { --chart-left: 130px; }

    html, body { margin:0; padding:0; background:#fff; }
    body {
      font-family: "Source Sans 3", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color:#111;
    }

    .wrap { padding: 12px 12px 12px; box-sizing: border-box; }

    .chart-title {
      margin: 0 0 8px;
      font-size: 22px;
      line-height: 1.15;
      font-weight: 700;
      text-align: left;

      white-space: normal;
      overflow: visible;
      text-overflow: clip;
    }

    #chart2 { width: 100%; }

    /* Compact legend to help avoid iframe scrollbars */
    .legend {
      margin: 6px 0 0;
      padding-left: var(--chart-left);
      padding-right: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px 14px;
      align-items: center;
      font-size: 14px;
      line-height: 1.2;
      color: #111;
    }

    .legend-item { display:inline-flex; align-items:center; gap:8px; }
    .swatch { width:18px; height:12px; border-radius:2px; display:inline-block; }

    .caption {
      margin: 6px 0 0;
      padding-left: var(--chart-left);
      padding-right: 6px;
      text-align: left;
      font-size: 14px;
      line-height: 1.35;
      color: #333;
    }

    @media (max-width: 420px) {
      .chart-title { font-size: 20px; }
      .wrap { padding: 10px 10px 10px; }
      .legend { font-size: 13px; }
      .caption { font-size: 13px; }
    }
  </style>

  <script>
    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    function computeLeftPadding(w) {
      // Reduce left margin on mobile to increase plot width
      if (w < 360) return 92;
      if (w < 420) return 102;
      if (w < 520) return 112;
      return 140;
    }

    function dataForBarChart(withAnnotations) {
      if (!withAnnotations) {
        return google.visualization.arrayToDataTable([
          ['Group', 'Severe Symptoms', 'Moderate Symptoms', 'Minimal Symptoms', 'No Response'],
          ['Trans People', 42, 14, 3, 40],
          ['Other', 27, 39, 2, 32],
          ['Cis Women', 10, 24, 9, 57],
          ['Cis Men', 9, 20, 6, 66]
        ]);
      }

      // Annotation columns: desktop/tablet only
      return google.visualization.arrayToDataTable([
        ['Group',
          'Severe Symptoms',   { role:'annotation' },
          'Moderate Symptoms', { role:'annotation' },
          'Minimal Symptoms',  { role:'annotation' },
          'No Response',       { role:'annotation' }
        ],
        ['Trans People', 42, '42%', 14, '14%', 3, '3%', 40, '40%'],
        ['Other',       27, '27%', 39, '39%', 2, '2%', 32, '32%'],
        ['Cis Women',   10, '10%', 24, '24%', 9, '9%', 57, '57%'],
        ['Cis Men',      9, '9%',  20, '20%', 6, '6%', 66, '66%']
      ]);
    }

    function dataForColumnChart() {
      // ColumnChart wants categories along the x-axis (Group as first column)
      // No annotations on mobile (they collide in stacked columns)
      return google.visualization.arrayToDataTable([
        ['Group', 'Severe Symptoms', 'Moderate Symptoms', 'Minimal Symptoms', 'No Response'],
        ['Trans People', 42, 14, 3, 40],
        ['Other', 27, 39, 2, 32],
        ['Cis Women', 10, 24, 9, 57],
        ['Cis Men', 9, 20, 6, 66]
      ]);
    }

    function drawChart2() {
      const el = document.getElementById('chart2');
      const wrap = el.parentElement;
      const w = wrap.clientWidth || 700;

      const left = computeLeftPadding(w);
      document.documentElement.style.setProperty('--chart-left', left + 'px');

      const isMobile = w < 520;

      // Height tuned to reduce iframe scroll:
      // - mobile needs more height for stacked columns + axis labels
      const chartHeight = isMobile
        ? clamp(Math.round(w * 1.35), 420, 620)
        : 520;

      const common = {
        height: chartHeight,
        backgroundColor: 'transparent',
        colors: ['#000F46', '#003C55', '#2C421D', '#2D2D2D'],
        isStacked: true,
        legend: { position: 'none' }
      };

      if (isMobile) {
        // Mobile: stacked ColumnChart uses width better and avoids “thin” bars
        const data = dataForColumnChart();

        const options = {
          ...common,
          bar: { groupWidth: '62%' },

          hAxis: {
            textStyle: { fontName: 'Source Sans 3', fontSize: 12 },
            slantedText: false
          },

          vAxis: {
            minValue: 0,
            maxValue: 100,
            ticks: [0, 20, 40, 60, 80, 100],
            textStyle: { fontName: 'Source Sans 3', fontSize: 12 }
          },

          chartArea: {
            left: 46,
            right: 12,
            top: 10,
            bottom: 44,
            width: '100%',
            height: '70%'
          }
        };

        new google.visualization.ColumnChart(el).draw(data, options);
        return;
      }

      // Desktop/tablet: stacked horizontal BarChart with annotations
      const data = dataForBarChart(true);

      const options = {
        ...common,

        hAxis: {
          minValue: 0,
          maxValue: 100,
          ticks: [0, 20, 40, 60, 80, 100],
          textStyle: { fontName: 'Source Sans 3', fontSize: 14 }
        },

        vAxis: {
          textStyle: { fontName: 'Source Sans 3', fontSize: 18 }
        },

        annotations: {
          alwaysOutside: false,
          textStyle: {
            fontName: 'Source Sans 3',
            fontSize: 15,
            color: '#FFFFFF',
            auraColor: 'transparent',
            auraWidth: 0
          }
        },

        bar: { groupWidth: '62%' },

        chartArea: {
          left: left,
          right: 22,
          top: 8,
          bottom: 30
        }
      };

      new google.visualization.BarChart(el).draw(data, options);
    }

    function init() {
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(drawChart2);

      let t;
      window.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          if (window.google && google.visualization) drawChart2();
        }, 150);
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</head>

<body>
  <div class="wrap">
    <h2 class="chart-title">Which genders are most likely to experience severe long COVID?</h2>
    <div id="chart2"></div>

    <div class="legend" aria-label="Legend">
      <span class="legend-item"><span class="swatch" style="background:#000F46"></span>Severe Symptoms</span>
      <span class="legend-item"><span class="swatch" style="background:#003C55"></span>Moderate Symptoms</span>
      <span class="legend-item"><span class="swatch" style="background:#2C421D"></span>Minimal Symptoms</span>
      <span class="legend-item"><span class="swatch" style="background:#2D2D2D"></span>No Response</span>
    </div>

    <div class="caption">
      Share of people who had COVID and developed Long COVID, by gender, December 2022
    </div>
  </div>
</body>
</html>
