<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chart 2</title>

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    :root{
      --c-severe:  #000F46;
      --c-moderate:#003C56;
      --c-minimal: #2C421C;
      --c-none:    #2D2D2D;

      /* Desktop */
      --title-size-desktop: 22px;
      --legend-size-desktop: 14px;
      --caption-size-desktop: 14px;

      /* Mobile (reduced vs previous) */
      --title-size-mobile: 24px;
      --legend-size-mobile: 15px;
      --caption-size-mobile: 16px;
    }

    html, body {
      margin: 0;
      background: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      color: #111;
    }

    /* IMPORTANT:
       Keep the embed from creating its own scrollbars, but still allow the layout to fit.
       If the Wix embed element is shorter than the content, Wix will clip no matter what.
       This codeâ€™s job is to minimise height on mobile and prevent overlaps. */
    body { overflow: hidden; }

    #wrap{
      height: 100vh;         /* match iframe viewport */
      width: 100%;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }

    #chartTitle{
      font-weight: 800;
      line-height: 1.08;
      padding: 12px 14px 6px;
      font-size: var(--title-size-desktop);
    }

    /* Chart container: JS will set an explicit pixel height on every draw */
    #chart{
      width: 100%;
      flex: 0 0 auto;
    }

    /* Desktop legend (inline wrap) */
    #legend{
      padding: 8px 14px 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      align-items: center;
      font-size: var(--legend-size-desktop);
    }

    .legItem{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .swatch{
      width: 26px;
      height: 12px;
      border-radius: 2px;
      flex: 0 0 auto;
    }

    #caption{
      padding: 8px 14px 12px;
      font-size: var(--caption-size-desktop);
      line-height: 1.25;
      color: #222;
    }

    @media (max-width: 600px){
      #chartTitle{
        font-size: var(--title-size-mobile);
        padding: 10px 14px 4px;
      }

      /* Mobile legend becomes a 2-column grid to reduce height and avoid paging/cutoff */
      #legend{
        font-size: var(--legend-size-mobile);
        padding: 6px 14px 6px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 14px;
        row-gap: 10px;
        align-items: start;
      }

      .swatch{
        width: 22px;
        height: 12px;
      }

      #caption{
        font-size: var(--caption-size-mobile);
        padding: 8px 14px 12px;
      }
    }
  </style>
</head>

<body>
  <div id="wrap">
    <div id="chartTitle">Which genders are most likely to experience severe long COVID?</div>

    <div id="chart"></div>

    <div id="legend" aria-label="Legend">
      <span class="legItem"><span class="swatch" style="background: var(--c-severe)"></span>Severe Symptoms</span>
      <span class="legItem"><span class="swatch" style="background: var(--c-moderate)"></span>Moderate Symptoms</span>
      <span class="legItem"><span class="swatch" style="background: var(--c-minimal)"></span>Minimal Symptoms</span>
      <span class="legItem"><span class="swatch" style="background: var(--c-none)"></span>No Response</span>
    </div>

    <div id="caption">Share of people who had COVID and developed Long COVID, by gender, December 2022</div>
  </div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(init);

    let chart, data, ro;

    function init() {
      chart = new google.visualization.ColumnChart(document.getElementById('chart'));

      // Exact published values (including Cis Men "No Response" = 66)
      data = google.visualization.arrayToDataTable([
        ['Gender', 'Severe Symptoms', 'Moderate Symptoms', 'Minimal Symptoms', 'No Response'],
        ['Trans People', 42, 14, 3, 40],
        ['Other',       27, 39, 2, 32],
        ['Cis Women',   10, 24, 9, 57],
        ['Cis Men',      9, 20, 6, 66]
      ]);

      draw();

      // Redraw on resize/orientation changes
      ro = new ResizeObserver(() => draw());
      ro.observe(document.documentElement);

      window.addEventListener('orientationchange', () => setTimeout(draw, 200));
    }

    function draw() {
      const wrap = document.getElementById('wrap');
      const titleEl = document.getElementById('chartTitle');
      const legendEl = document.getElementById('legend');
      const captionEl = document.getElementById('caption');
      const chartEl = document.getElementById('chart');

      const w = wrap.clientWidth;
      const h = wrap.clientHeight;

      // Reserve exactly what the HTML title/legend/caption actually take up
      const reserved =
        titleEl.offsetHeight +
        legendEl.offsetHeight +
        captionEl.offsetHeight;

      // Remaining height for the chart
      const chartH = Math.max(180, h - reserved);

      // CRITICAL FIX:
      // Set the container height explicitly so iOS/Safari cannot let the SVG overlap below.
      chartEl.style.height = chartH + 'px';

      const isMobile = w <= 600;

      const options = {
        backgroundColor: 'transparent',
        isStacked: true,
        colors: ['#000F46', '#003C56', '#2C421C', '#2D2D2D'],

        // Using HTML title + HTML legend
        title: '',
        legend: 'none',

        animation: { duration: 0 },

        width: w,
        height: chartH,

        chartArea: {
          left: isMobile ? 44 : 60,
          right: isMobile ? 12 : 18,
          top: 10,
          bottom: isMobile ? 42 : 36,
          width: '100%',
          height: '100%'
        },

        vAxis: {
          viewWindow: { min: 0, max: 100 },
          ticks: [0, 20, 40, 60, 80, 100],
          gridlines: { color: '#d0d0d0' },
          textStyle: { fontSize: isMobile ? 14 : 12, color: '#333' }
        },

        hAxis: {
          textStyle: { fontSize: isMobile ? 16 : 12, color: '#222' }
        },

        tooltip: { trigger: 'focus', isHtml: true },
        focusTarget: 'category'
      };

      chart.draw(data, options);
    }
  </script>
</body>
</html>
