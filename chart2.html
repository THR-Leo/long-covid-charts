<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chart 2</title>

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    /* Prevent internal scrollbars inside the embed */
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: #ffffff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
    }

    #wrap {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* Chart fills all space above caption strip (set in JS) */
    #chart {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
    }

    /* Caption fixed at bottom */
    #caption {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      box-sizing: border-box;
      background: #fff;
      color: #222;
      padding: 10px 16px 12px;
      font-size: 18px;
      line-height: 1.25;
    }

    @media (max-width: 480px) {
      #caption {
        font-size: 16px;
        padding: 10px 14px 12px;
      }
    }
  </style>
</head>

<body>
  <div id="wrap">
    <div id="chart"></div>
    <div id="caption">Share of people who had COVID and developed Long COVID, by gender, December 2022</div>
  </div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(init);

    let chart, data, ro;

    function init() {
      chart = new google.visualization.ColumnChart(document.getElementById('chart'));

      /* Chart 2 values (corrected: Cis Men "No Response" = 66) */
      data = google.visualization.arrayToDataTable([
        ['Gender', 'Severe Symptoms', 'Moderate Symptoms', 'Minimal Symptoms', 'No Response'],
        ['Trans People', 42, 14, 3, 40],
        ['Other',       27, 39, 2, 32],
        ['Cis Women',   10, 24, 9, 57],
        ['Cis Men',      9, 20, 6, 66]
      ]);

      draw();

      /* Resize redraw without animation to reduce tooltip flicker */
      ro = new ResizeObserver(() => draw());
      ro.observe(document.body);

      window.addEventListener('orientationchange', () => setTimeout(draw, 150));
    }

    function draw() {
      const wrap = document.getElementById('wrap');
      const chartDiv = document.getElementById('chart');

      const w = wrap.clientWidth;
      const h = wrap.clientHeight;

      const isMobile = w <= 600;

      /* Reserve space for caption so it never clips */
      const captionH = isMobile ? 78 : 60;
      chartDiv.style.bottom = captionH + 'px';

      /* Legend sizing (keeps labels visible) */
      const legendFont = isMobile ? 12 : 13;
      const legendLines = isMobile ? 2 : 1;

      /* Title sizing */
      const titleFont = isMobile ? 26 : 20;

      const options = {
        backgroundColor: 'transparent',
        isStacked: true,

        /* Your established palette */
        colors: ['#000F46', '#003C56', '#2C421C', '#2D2D2D'],

        title: 'Which genders are most likely to experience severe long COVID?',
        titleTextStyle: {
          fontSize: titleFont,
          bold: true,
          color: '#111'
        },

        /* No animation (helps tooltip stability) */
        animation: { duration: 0 },

        width: w,
        height: h - captionH,

        chartArea: {
          left: isMobile ? 52 : 60,
          right: isMobile ? 18 : 18,
          top: isMobile ? 72 : 58,
          bottom: isMobile ? 100 : 82,
          width: '100%',
          height: '100%'
        },

        legend: {
          position: 'bottom',
          maxLines: legendLines,
          textStyle: {
            fontSize: legendFont,
            color: '#111'
          }
        },

        vAxis: {
          viewWindow: { min: 0, max: 100 },
          ticks: [0, 20, 40, 60, 80, 100],
          gridlines: { color: '#d0d0d0' },
          textStyle: { fontSize: 12, color: '#333' }
        },

        hAxis: {
          textStyle: { fontSize: isMobile ? 14 : 12, color: '#222' }
        },

        tooltip: {
          trigger: 'focus',
          isHtml: true
        },

        focusTarget: 'category'
      };

      chart.draw(data, options);
    }
  </script>
</body>
</html>
