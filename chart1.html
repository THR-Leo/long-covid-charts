<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chart 1</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    :root { --chart-left: 130px; }

    html, body { margin:0; padding:0; background:#fff; }
    body {
      font-family: "Source Sans 3", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      color:#111;
      overflow: hidden; /* prevents internal scrollbars */
    }

    .wrap { padding: 12px 12px 10px; }

    .chart-title {
      margin: 0 0 8px;
      font-size: 22px;
      line-height: 1.15;
      font-weight: 700;
      text-align: left;
    }

    #chart1 { width: 100%; }

    .caption {
      margin: 8px 0 0;
      padding-left: var(--chart-left);
      padding-right: 8px;
      text-align: left;
      font-size: 14px;
      color: #333;
    }

    @media (max-width: 420px) {
      .wrap { padding: 10px 12px 8px; }
      .chart-title { font-size: 18px; margin-bottom: 6px; }
      .caption { font-size: 13px; margin-top: 6px; }
    }
  </style>

  <script>
    function computeLeftPadding(w) {
      if (w < 360) return 105;
      if (w < 420) return 115;
      if (w < 520) return 125;
      return 140;
    }

    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    function drawChart1() {
      const wrap = document.querySelector('.wrap');
      const el = document.getElementById('chart1');
      const titleEl = document.querySelector('.chart-title');
      const capEl = document.querySelector('.caption');

      const w = wrap.clientWidth || 700;
      const left = computeLeftPadding(w);
      document.documentElement.style.setProperty('--chart-left', left + 'px');

      const isMobile = w < 520;

      // Fill available iframe height to avoid blank space inside the Wix HTML component.
      // (window.innerHeight in this iframe == Wix element height on that breakpoint)
      const wrapStyles = getComputedStyle(wrap);
      const padTop = parseFloat(wrapStyles.paddingTop) || 0;
      const padBottom = parseFloat(wrapStyles.paddingBottom) || 0;

      const titleH = titleEl ? titleEl.getBoundingClientRect().height : 0;
      const capH = capEl ? capEl.getBoundingClientRect().height : 0;

      // extra spacing between blocks (title->chart, chart->caption)
      const chromeH = padTop + padBottom + titleH + capH + (isMobile ? 12 : 16);

      // Choose sensible bounds so charts never become absurdly tall/short
      const minH = isMobile ? 330 : 360;
      const maxH = isMobile ? 520 : 560;

      const targetChartH = clamp((window.innerHeight || 600) - chromeH, minH, maxH);

      const data = google.visualization.arrayToDataTable([
        ['Group', 'Percent', { role: 'annotation' }],
        ['Trans People', 46, '46%'],
        ['Other', 37, '37%'],
        ['Cis Women', 32, '32%'],
        ['Cis Men', 22, '22%']
      ]);

      const options = {
        height: Math.round(targetChartH),
        legend: { position: 'none' },
        backgroundColor: 'transparent',
        colors: ['#000F46'],

        hAxis: {
          minValue: 0,
          maxValue: 50,
          ticks: [0,10,20,30,40,50],
          textStyle: { fontName: 'Source Sans 3', fontSize: isMobile ? 12 : 14 }
        },

        vAxis: {
          textStyle: { fontName: 'Source Sans 3', fontSize: isMobile ? 16 : 18 }
        },

        annotations: {
          alwaysOutside: true,
          textStyle: {
            fontName: 'Source Sans 3',
            fontSize: isMobile ? 12 : 14,
            color: '#111',
            auraColor: 'transparent',
            auraWidth: 0
          }
        },

        bar: { groupWidth: isMobile ? '62%' : '70%' },

        chartArea: {
          left: left,
          right: isMobile ? 26 : 34,
          top: 6,
          bottom: 34
        }
      };

      new google.visualization.BarChart(el).draw(data, options);
    }

    function init() {
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(drawChart1);

      let t;
      window.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          if (window.google && google.visualization) drawChart1();
        }, 120);
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</head>

<body>
  <div class="wrap">
    <h2 class="chart-title">Which genders are most likely to develop long COVID?</h2>
    <div id="chart1"></div>
    <div class="caption">Long COVID symptom severity, by gender, December 2022</div>
  </div>
</body>
</html>
